<!DOCTYPE html>
<html>

<head lang="en">
  <meta charset="utf-8" />

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="icon" href="./assets/Emerginov.ico" />
  <link rel="stylesheet" type="text/css" href="./css/index.css">
  <script type="text/javascript" src="./js/index.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>

  <!-- 2 load the theme CSS file -->
  <link rel="stylesheet" href="plugin/codemirror/addon/display/fullscreen.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/themes/default/style.min.css" />
  <title>Editeur</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="plugin/codemirror/lib/codemirror.js"></script>

  <!--<script src="plugin/Codemirror/addon/comment/comment.js"></script>
  <script src="plugin/Codemirror/addon/display/fullscreen.js"></script>-->
  <script src="plugin/codemirror/addon/hint/show-hint.js"></script>
  <script src="plugin/codemirror/addon/hint/anyword-hint.js"></script>
  <script src="plugin/codemirror/addon/hint/html-hint.js"></script>
  <script src="plugin/codemirror/addon/hint/javascript-hint.js"></script>
  <script src="plugin/codemirror/addon/hint/css-hint.js"></script>
  <link rel="stylesheet" href="plugin/codemirror/addon/hint/show-hint.css"/>
  <link rel="stylesheet" href="plugin/codemirror/lib/codemirror.css"/>
  <script src="plugin/codemirror/mode/xml/xml.js"></script>
  <script src="plugin/codemirror/mode/htmlmixed/htmlmixed.js"></script>
  <script src="plugin/codemirror/mode/php/php.js"></script>
  <script src="plugin/codemirror/mode/clike/clike.js"></script>
  <script src="plugin/codemirror/mode/javascript/javascript.js"></script>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
  <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
  <link rel="stylesheet" href="plugin/codemirror/theme/dracula.css"/>
  <link rel="stylesheet" href="plugin/codemirror/theme/blackboard.css"/>
  <link rel="stylesheet" href="plugin/codemirror/theme/xq-dark.css"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.dev.js"></script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<style>
/* Absolute Center Spinner */
.loading {
  position: fixed;
  z-index: 999;
  height: 2em;
  width: 2em;
  overflow: show;
  margin: auto;
  top: 0;
  left: 0;
  bottom: 0;
  right: 0;
}

/* Transparent Overlay */
.loading:before {
  content: '';
  display: block;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
    background: radial-gradient(rgba(20, 20, 20,.8), rgba(0, 0, 0, .8));

  background: -webkit-radial-gradient(rgba(20, 20, 20,.8), rgba(0, 0, 0,.8));
}

/* :not(:required) hides these rules from IE9 and below */
.loading:not(:required) {
  /* hide "loading..." text */
  font: 0/0 a;
  color: transparent;
  text-shadow: none;
  background-color: transparent;
  border: 0;
}

.loading:not(:required):after {
  content: '';
  display: block;
  font-size: 10px;
  width: 1em;
  height: 1em;
  margin-top: -0.5em;
  -webkit-animation: spinner 150ms infinite linear;
  -moz-animation: spinner 150ms infinite linear;
  -ms-animation: spinner 150ms infinite linear;
  -o-animation: spinner 150ms infinite linear;
  animation: spinner 150ms infinite linear;
  border-radius: 0.5em;
  -webkit-box-shadow: rgba(255,255,255, 0.75) 1.5em 0 0 0, rgba(255,255,255, 0.75) 1.1em 1.1em 0 0, rgba(255,255,255, 0.75) 0 1.5em 0 0, rgba(255,255,255, 0.75) -1.1em 1.1em 0 0, rgba(255,255,255, 0.75) -1.5em 0 0 0, rgba(255,255,255, 0.75) -1.1em -1.1em 0 0, rgba(255,255,255, 0.75) 0 -1.5em 0 0, rgba(255,255,255, 0.75) 1.1em -1.1em 0 0;
box-shadow: rgba(255,255,255, 0.75) 1.5em 0 0 0, rgba(255,255,255, 0.75) 1.1em 1.1em 0 0, rgba(255,255,255, 0.75) 0 1.5em 0 0, rgba(255,255,255, 0.75) -1.1em 1.1em 0 0, rgba(255,255,255, 0.75) -1.5em 0 0 0, rgba(255,255,255, 0.75) -1.1em -1.1em 0 0, rgba(255,255,255, 0.75) 0 -1.5em 0 0, rgba(255,255,255, 0.75) 1.1em -1.1em 0 0;
}

/* Animation */

@-webkit-keyframes spinner {
  0% {
    -webkit-transform: rotate(0deg);
    -moz-transform: rotate(0deg);
    -ms-transform: rotate(0deg);
    -o-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
    -moz-transform: rotate(360deg);
    -ms-transform: rotate(360deg);
    -o-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}
@-moz-keyframes spinner {
  0% {
    -webkit-transform: rotate(0deg);
    -moz-transform: rotate(0deg);
    -ms-transform: rotate(0deg);
    -o-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
    -moz-transform: rotate(360deg);
    -ms-transform: rotate(360deg);
    -o-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}
@-o-keyframes spinner {
  0% {
    -webkit-transform: rotate(0deg);
    -moz-transform: rotate(0deg);
    -ms-transform: rotate(0deg);
    -o-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
    -moz-transform: rotate(360deg);
    -ms-transform: rotate(360deg);
    -o-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}
@keyframes spinner {
  0% {
    -webkit-transform: rotate(0deg);
    -moz-transform: rotate(0deg);
    -ms-transform: rotate(0deg);
    -o-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
    -moz-transform: rotate(360deg);
    -ms-transform: rotate(360deg);
    -o-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}
		.chat{
			margin-top: 100px;
			margin-bottom: auto;
			margin-left: -55px
		}

		.card{
			font-size: 11px;
			height:400px;
			width: 265px;
			border-radius: 15px !important;
			background-color: rgba(0,0,0,0.4) !important;
		}
		.contacts_body{
			padding:  0.75rem 0 !important;
			overflow-y: auto;
			white-space: nowrap;
		}
		.msg_card_body{
			overflow-y: auto;

		}
		.card-header{
			border-radius: 15px 15px 0 0 !important;
			border-bottom: 0 !important;
		}
	 .card-footer{
		border-radius: 0 0 15px 15px !important;
			border-top: 0 !important;

	}
		.container{
			align-content: center;

		}

		.search{
			border-radius: 15px 0 0 15px !important;
			background-color: rgba(0,0,0,0.3) !important;
			border:0 !important;
			color:white !important;

		}
		.search:focus{
		     box-shadow:none !important;
           outline:0px !important;
		}
		.type_msg{
			background-color: rgba(0,0,0,0.3) !important;
			border:0 !important;
			color:white !important;
			height: 40px !important;
			overflow-y: auto;
		}
			.type_msg:focus{
		     box-shadow:none !important;
           outline:0px !important;
		}
		.attach_btn{
	border-radius: 15px 0 0 15px !important;
	background-color: rgba(0,0,0,0.3) !important;
			border:0 !important;
			color: white !important;
			cursor: pointer;
		}
		.send_btn{
	border-radius: 0 15px 15px 0 !important;
	background-color: rgba(0,0,0,0.3) !important;
			border:0 !important;
			color: white !important;
			cursor: pointer;
		}
		.search_btn{
			border-radius: 0 15px 15px 0 !important;
			background-color: rgba(0,0,0,0.3) !important;
			border:0 !important;
			color: white !important;
			cursor: pointer;
		}
		.contacts{
			list-style: none;
			padding: 0;
		}
		.contacts li{
			width: 100% !important;
			padding: 5px 1px;
			margin-bottom: 15px !important;
		}
	.active{
			background-color: rgba(0,0,0,0.3);
	}
		.user_img{
			height: 50px;
			width: 50px;
			border:1.5px solid #f5f6fa;

		}
		.user_img_msg{
			height: 40px;
			width: 40px;
			border:1.5px solid #f5f6fa;

		}
	.img_cont{
			position: relative;
			height: 50px;
			width: 50px;
	}
	.img_cont_msg{
			height: 40px;
			width: 40px;
	}
	.online_icon{
		position: absolute;
		height: 10px;
		width:10px;
		background-color: #4cd137;
		border-radius: 50%;
		bottom: 0.2em;
		right: 0.4em;
		border:1.5px solid white;
	}
	.offline{
		background-color: #c23616 !important;
	}
	.user_info{
		margin-top: auto;
		margin-bottom: auto;
		margin-left: 15px;
	}
	.user_info span{
		font-size: 20px;
		color: white;
	}
	.user_info p{
	font-size: 10px;
	color: rgba(255,255,255,0.6);
	}
	.video_cam{
		margin-left: 50px;
		margin-top: 5px;
	}
	.video_cam span{
		color: white;
		font-size: 20px;
		cursor: pointer;
		margin-right: 20px;
	}
	.msg_cotainer{
		margin-top: auto;
		margin-bottom: auto;
		margin-left: 10px;
		border-radius: 25px;
		background-color: #82ccdd;
		padding: 10px;
		position: relative;
	}
	.msg_cotainer_send{
		margin-top: auto;
		margin-bottom: auto;
		margin-right: 10px;
		border-radius: 25px;
		background-color: #78e08f;
		padding: 10px;
		position: relative;
	}
	.msg_time{
		position: absolute;
		left: 0;
		bottom: -15px;
		color: rgba(255,255,255,0.5);
		font-size: 10px;
	}
	.msg_time_send{
		position: absolute;
		right:0;
		bottom: -15px;
		color: rgba(255,255,255,0.5);
		font-size: 10px;
	}
	.msg_head{
		position: relative;
	}
	#action_menu_btn{
		position: absolute;
		right: 10px;
		top: 10px;
		color: white;
		cursor: pointer;
		font-size: 20px;
	}
	.action_menu{
		z-index: 1;
		position: absolute;
		padding: 15px 0;
		background-color: rgba(0,0,0,0.5);
		color: white;
		border-radius: 15px;
		top: 30px;
		right: 15px;
		display: none;
	}
	.action_menu ul{
		list-style: none;
		padding: 0;
	margin: 0;
	}
	.action_menu ul li{
		width: 100%;
		padding: 10px 15px;
		margin-bottom: 5px;
	}
	.action_menu ul li i{
		padding-right: 10px;

	}
	.action_menu ul li:hover{
		cursor: pointer;
		background-color: rgba(0,0,0,0.2);
	}
	@media(max-width: 576px){
	.contacts_card{
		margin-bottom: 15px !important;
	}
	}
   body {

     background:  	#505050;}
   *{
    padding: 0;
    margin: 0;
   }

   #chatBox{
     background: white;
   }
   .main{
    width: 100%;
    height: 100%;
    display: inline-flex;
   }
   .bs-example{
    margin: 20px;
   }
   #viewer{
    background: white;
    margin: 30px;
    margin-left: 100px;
    margin-top: -30px;
    width: 100%;
    height: 658px;
    top:30;

    resize: vertical;
    border: 1px solid #3498db
   }
   #editor-textarea
   {
     height: 100%;
     resize: vertical;
   }
   #X,#Y,#Z,#T,#U
   {
    visibility: hidden;}
  .center-div {
    margin: 0 auto;
    width: 100px;}
  .tree :first-child {
    width: 30px;
    color: #A0A0A0;
  }

  .nav{
    background: #DDDCDB;}
  .CodeMirror-activeline-background {
    background-color:#F0E68C;
  }

  #suggestions {
    -moz-box-sizing: border-box;
    box-sizing: border-box;
    border: 1px solid black;
    position: absolute;
    left: 1290px;
    top: 16px;
    background-color: white;

}

.option{
   display:none;
}
/* The popup form - hidden by default */
.form-popup {
  display: none;
  position: fixed;
  right:40%;
  border: 3px solid #f1f1f1;
  z-index: 9;
}

/* Add styles to the form container */
.form-container {
  max-width: 300px;
  padding: 10px;
  background-color: #505050;
}

/* Full-width input fields */
.form-container input[type=text], .form-container input[type=password] {
  width: 100%;
  padding: 10px;
  margin: 5px 0 22px 0;
  border: none;
  background: #f1f1f1;
}

/* When the inputs get focus, do something */
.form-container input[type=text]:focus, .form-container input[type=password]:focus {
  background-color: #ddd;
  outline: none;
}

/* Set a style for the submit/login button */
.form-container .btn {
  background-color: #4CAF50;
  color: white;
  padding: 16px 20px;
  border: none;
  cursor: pointer;
  width: 100%;
  margin-bottom:10px;
  opacity: 0.8;
}

/* Add a red background color to the cancel button */
.form-container .cancel {
  background-color: red;
}

/* Add some hover effects to buttons */
.form-container .btn:hover, .open-button:hover {
  opacity: 1;
}
</style>
</head>

<body>
  <div class="bd-example">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <a id="titre" class="navbar-brand" href="#">
 <img src="./assets/Emerginov.png" width="30" height="30" alt="logo">
Emerginov Editor
</a>


    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item ">
          <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            New Project
          </a>
          <div style="  background-color: #505050;"  class="dropdown-menu" aria-labelledby="navbarDropdown">

          <input id="NewProjectName" class="form-control mr-sm-2" type="text" placeholder="    Project Name" >
          <button style="margin-top: 5px;margin-left:40px;" id="createProject" type="submit" class="btn btn-secondary">create</button>
          </div>

        </li>

        <li class="nav-item">
          <a id="run" class="nav-link"  type="button" target="viewer">Run</a>
        </li>
        <li class="nav-item">
          <a class="nav-link " id="saved" onkeypress="pressControlS(event)" onclick="save()" href="#">save</a>
        </li>

        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Github
          </a>
          <div style="  background-color: #505050;"class="dropdown-menu" aria-labelledby="navbarDropdown">
            <a class="dropdown-item" style="color: #DDDCDB"href="#" onclick="openForm()">Commit & Push</a>
            <a class="dropdown-item" style="color: #DDDCDB"href="#" onclick="pullRepo()" >Pull</a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Themes
          </a>
          <div style="  background-color: #505050;" class="dropdown-menu" aria-labelledby="navbarDropdown">
            <a style="color: #DDDCDB"class="dropdown-item" href="#" onclick="theme3()">The Dark</a>
            <a class="dropdown-item" style="color: #DDDCDB;" href="#"onclick="theme2()">BlackBoard</a>
            <a class="dropdown-item"  style="color:#DDDCDB;" href="#"onclick="theme1()">Dracula</a>

            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="#"  style="color: #DDDCDB;" onclick="theme0()">Default</a>
          </div>

        </li>


       </ul>
       <ul class="navbar-nav mr-auto">
         <li class="alert alert-danger" id="alertSearch" class="nav-item">
           <a  role="alert"> Sorry, this user does not exist.
           </a>
         </li>
       </ul>
<ul  class="form-inline  my-2 my-lg-0">
       <div class="dropdown nav-button notifications-button hidden-sm-down">

         <a class="btn btn-secondary dropdown-toggle" href="#" id="notifications-dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
           <i id="notificationsIcon" class="fa fa-bell-o" aria-hidden="true"></i>
           <span id="notificationsBadge" class="badge badge-danger"><i class="fa fa-spinner fa-pulse fa-fw" aria-hidden="true"></i></span>
         </a>

         <!-- NOTIFICATIONS -->
         <div class="dropdown-menu notification-dropdown-menu" aria-labelledby="notifications-dropdown">
           <h6 class="dropdown-header">Notifications</h6>

           <!-- CHARGEMENT -->
           <a id="notificationsLoader" class="dropdown-item dropdown-notification" href="#">
             <p class="notification-solo text-center"><i id="notificationsIcon" class="fa fa-spinner fa-pulse fa-fw" aria-hidden="true"></i> Chargement des dernières notifications...</p>
           </a>

           <div id="notificationsContainer" class="notifications-container"></div>

           <!-- AUCUNE NOTIFICATION -->
           <a id="notificationAucune" class="dropdown-item dropdown-notification" href="#">
             <p class="notification-solo text-center">Aucune nouvelle notification</p>
           </a>

         </ul>

         </div>
       <ul class="form-inline my-2 my-lg-0" >

        <input onkeypress="pressEnterInSearch()" id="search" list="livesearch" class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search" onkeyup="showResult(this.value)" >

        <datalist id="livesearch">
        </datalist>
        <button  onclick="gotoProfile()" class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>

        <div  class="collapse navbar-collapse" id="navbar-list-4">
      <ul style="margin-right:30px;" class="navbar-nav">
          <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <img id="LogoutImage" src=""  width="40" height="40" class="rounded-circle">
          </a>
          <div  class="dropdown-menu p-1" aria-labelledby="navbarDropdownMenuLink">
            <a type="button" class="dropdown-item" href="#">Database</a>
            <a type="button"class="dropdown-item" onclick="editProfile()" >Edit Profile</a>
            <a type="button"class="dropdown-item" onclick="logout()">Log Out</a>
          </div>
        </li>
      </ul>
    </div>
  </ul>


    <!--  <button class="btn btn-outline-danger my-2 my-sm-0" type="submit">Logout</button>-->

    </div>
  </nav>
  </div>



<!--<button type="button" class="btn btn-warning">Warning</button>
<button type="button" class="btn btn-info">Info</button>
<button type="button" class="btn btn-light">Light</button>
<button type="button" class="btn btn-dark">Dark</button>-->

<div id="load" class="loading">Loading&#8230;</div>

<div class="form-popup" id="myForm">
  <div
  id="formPush"
  class="form-container"

  >
    <label style="color:white;" for="email"><b>Git username</b></label>
    <input id="userGit" type="text" placeholder="Enter username" name="gitusername" required>

    <label style="color:white;" for="psw"><b>Git password</b></label>
    <input id="pswGit"type="password" placeholder="Enter Password" name="password" required>
    <label style="color:white;" for="psw"><b>Commit message</b></label>

    <input id="commitMessage"type="text" placeholder="Commit message" name="commitMessage" required>

    <button id="comBtn" type="submit" onclick="pushRepo()" class="btn">Commit&Push</button>
    <button type="button" class="btn cancel" onclick="closeForm()">Close</button>
  </div>
</div>


<div class="main">
   <!-- div for the tree-->
   <div style="margin-top:30px;" class="tree" id="jstree"></div>


  <!--  <div style=" margin-top:450px;">
        <button  style="margin-top:-50px; margin-left:100px"type="button" class="text-light bg-dark btn" disabled>Live Chat</button>
-->
        <!--<button  style="margin-left:0px" class="btn btn-success" onclick="RefreshSlack()">refresh conversation</button><button style="margin-left:0px" class="btn btn-danger" onclick="CleanConversation()">Clean the chat</button>-->

      <!--  <iframe name="Showframe" height="200px" width="300px" id="chatBox" ></iframe>

        <div style="margin-top: 10px;" >
          <input onkeypress="pressEnter(event)" id="inputSlack"  name="" type="text" placeholder="put a message here"><input onclick="putMastodonMessage()" type="submit">

       </div>
       <img style="margin-left:90px;margin-top:10px" src="./assets/mastodon.png" width="100px" alt="" />

     -->


   <!--div for the editor-->

    <div style="margin-top: 20px;margin-left: 350px;">

    <textarea  id="editor-textarea" class="editor" name="editor" placeholder="Put your code here !" ></textarea></div>
    <div style="margin-top: 20px;" class="bd-example">
      <div class="btn-group-vertical btn-group-sm " role="group" aria-label="Vertical button group">
         <button id="X" onclick="step_by_step()"  type="button" class="btn btn-secondary">By Step</button>
         <button id="Y" onclick="Resume()"      id="Y" type="button" class="btn btn-secondary">Next</button>
         <button id="Z" onclick="removeAll()" type="button" class="btn btn-secondary">RemoveAll </button>
         <button id="T" onclick="hideAll()" type="button" class="btn btn-secondary">Hide </button>
         <button id="U" onclick="showAll()" type="button" class="btn btn-secondary">Show All</button>
      </div>
    </div>
   <!-- div for the viewer-->
    <iframe name="viewer" style="margin-top: 20px;" id="viewer"></iframe>
</div>

<div style=" margin-top:-530px; margin-left:-250px" class="container">
   <div class="container-fluid h-100">
     <div class="row justify-content-center h-100">
       <div class="col-md-8 col-xl-6 chat">
         <div class="card">
           <div class="card-header msg_head">

             <div class="d-flex bd-highlight">
               <div class="img_cont">
                 <img id="chatphoto"  class="rounded-circle user_img">
                 <span class="online_icon"></span>
               </div>
               <div class="user_info">
                 <span> Chat</span>

                 <p id="numberOfMsgs"></p>
               </div>

               <div  class="video_cam">
                 <span onclick="CleanConversation()"><i style="margin-left:5px;" class="material-icons">delete</i></span>

               </div>
               <!-- <div class="video_cam">
                 <span><i class="fas fa-video"></i></span>
                 <span><i class="fas fa-phone"></i></span>
               </div> -->
             </div>
             <!-- <span id="action_menu_btn"><i class="fas fa-ellipsis-v"></i></span> -->
              <!-- <div class="action_menu">
               <ul>
                 <li><i class="fas fa-user-circle"></i> View profile</li>
                 <li><i class="fas fa-users"></i> Add to close friends</li>
                 <li><i class="fas fa-plus"></i> Add to group</li>
                 <li><i class="fas fa-ban"></i> Block</li>
               </ul>
             </div> -->
           </div>
           <div id="msgs" class="card-body msg_card_body">

           </div>
           <div class="card-footer">
             <div class="input-group">

               <textarea  onkeypress="pressEnter(event)" id="inputSlack" name="" class="form-control type_msg" placeholder="Type your message..."></textarea>
               <div class="input-group-append">
                 <span onclick="putMastodonMessage()" class="input-group-text send_btn"><i class="fa fa-paper-plane"></i></span>
               </div>
             </div>
           </div>
         </div>
       </div>
     </div>
   </div>
</div>
</div>
<script src="https://use.fontawesome.com/48bbc759d5.js"></script>


 <p id="demo"></p>
<!-- include the minified jstree source -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/jstree.min.js"></script>
<script id="notificationTemplate" type="text/html">
  <!-- NOTIFICATION -->
  <a id="{{allid}}"class="dropdown-item dropdown-notification" href="{{href}}">
    <div class="notification-read">
      <i class="fa fa-times" aria-hidden="true"></i>
    </div>
    <img id="notifImage" src={{image}} class="notification-img" />
    <div class="notifications-body">
      <p class="notification-texte">{{texte}}</p>
      <p class="notification-date text-muted">

      </p>

      <i id="{{Acceptid}}" type="button" onclick="acceptRequest(this.id)"style="background-color:green"class="btn btn-danger btn-sm fa fa-plus"> accept ?</i>
      <i id="{{Refuseid}}" type="button" onclick="refuseRequest(this.id)"style="background-color:red"class="btn btn-success btn-sm fa fa-times"> refuse ?</i>

    </div>

  </a>
</script>
<script>
$("#load").hide();
function pullRepo(){
  $.ajax({
      async: true,
      type: "POST",
      url: "http://localhost:3000/repos/pull",
      dataType:"json",
      data:{
        "id":sessionStorage.getItem('userID')
      },
      success: function (json) {
        if (json.message!=null) {
          if (json.message=="file have been pulled"){
            //alert("please verify your informations")
            //sweetAlert("files pulled successfully ! ", "Thank you", "success");
            Swal.fire({
              title: 'files pulled successfully !',
              text: "Thank you",
              icon: 'success',
            }).then((result) => {
              if (result.value) {
                window.location.reload()
              }
            })

          }else if (json.message=="No pull available") {
            Swal.fire({
              title: 'No pull available',
              text: "",
              icon: 'error',
            })
            //swal("All files are already pulled", "No pull available", "error");

          }else if (json.message=="you don't have any project") {
            Swal.fire({
              title: 'No project found',
              text: "Please choose or create a project",
              icon: 'error',
            })
          }else if (json.message=="error") {
          //  sweetAlert("No pull available","", "error");
          Swal.fire({
            title: 'No pull available',
            text: "",
            icon: 'error',
          })
          }



      }


      },
      error: function (xhr, ajaxOptions, thrownError) {
      }
  });
}
$(document).ready(function() {
  $("#comBtn").click(function() {
    // disable button
    $(this).prop("disabled", true);
    // add spinner to button
    $(this).html(
      `<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>Loading...`
    );
  });
});

function pushRepo(){

  let gitUsername=document.getElementById('userGit').value
  let password=document.getElementById('pswGit').value
  let commitMessage=document.getElementById('commitMessage').value


  // let gitUsername=document.forms["formPush"].gitUsername.value
  // let password=document.forms["formPush"].password.value
  $.ajax({
      async: true,
      type: "POST",
      url: "http://localhost:3000/repos/push",
      dataType:"json",
      data:{
        "id":sessionStorage.getItem("userID"),
        "commitMessage":commitMessage,
        "password":password,
        "gitusername":gitUsername
      },
      success: function (json) {
        if (json.message!=null) {
          if (json.message=="please put a commit message"){
            //alert("please verify your informations")
            Swal.fire({
              title: "Please put a commit message ",
              text: "",
              icon: 'error',
            }).then((value) => {
              if (value) {
                window.location.reload()

              }
            })
          //  sweetAlert("Incorrect informations","", "error");
            closeForm()


            return false
          }else if (json.message=="mot de passe incorrect") {
          //  sweetAlert("Incorrect password", "check informations", "error");
          Swal.fire({
            title: "Incorrect password",
            text: "check your informations",
            icon: 'error',
          })
            closeForm()

          }else if (json.message=="you don't have any project") {
            //sweetAlert("Project Not Found","", "error");
            Swal.fire({
              title: "Project not found !",
              text: "",
              icon: 'error',
            })
            return false

          }else if(json.message=="repo successfully pushed") {
            //sweetAlert("files pushed successfully ! ", "Thank you", "success");
            Swal.fire({
              title: 'files pushed successfully !',
              text: "Thank you",
              icon: 'success',
            })
            closeForm()
          }else if (json.message=="already pushed") {
            //sweetAlert("All files are already pushed","", "error");
            Swal.fire({
              title: "All files are already pushed !",
              text: "",
              icon: 'error',
            })
            closeForm()
          }

        }else {




        //  window.location.reload()
        }

      },
      error: function (xhr, ajaxOptions, thrownError) {
      }
  });
}
function openForm() {
  document.getElementById("myForm").style.display = "block";
}

function closeForm() {
  document.getElementById("myForm").style.display = "none";
}
function acceptRequest(e){
  var identifyid=e.replace("Accept","")
  identifyid=parseInt(identifyid)
  var myID=sessionStorage.getItem("userID");
  var texte=notifications[identifyid].texte.split(" ");
  console.log(texte);
  var projectName=""
  var senderLogin=notifications[identifyid].texte.split(" ")[0];
  if (texte.length>6) {
    for (var i = 5; i < texte.length; i++) {
      projectName+=texte[i]+" "

    }
  }else {
    console.log("hhello");
     projectName=notifications[identifyid].texte.split(" ")[5];

  }
  console.log(projectName);
  $.ajax({
      async: true,
      type: "POST",
      url: "http://localhost:3000/api/users/acceptRequest",
      dataType:"json",
      data:{
        "id":myID,
        "senderLogin":senderLogin,
        "name":projectName
      },
      success: function (json) {


      },
      error: function (xhr, ajaxOptions, thrownError) {

      }
  });
  $(`#${e}`).parent().parent()[0].remove();
  notifications.splice( identifyid, 1 );
  console.log(notifications);



}
$("#createProject").click(function(){
  let id=sessionStorage.getItem("userID")
  console.log(id);
  let spaceProblem=false;
  var projectName= $("#NewProjectName").val()
  //let projectName=document.getElementById("NewProjectName").text
  console.log(projectName);
  for (var i = 0; i < projectName.length; i++) {
    if (projectName[i]==" ") {
    spaceProblem=true;
    }

  }
  if (spaceProblem==true) {
    console.log("heyt");
    $("#alertSearch").text("No space permitted")
    $("#alertSearch").show()

  }
  console.log(projectName);
  if (projectName!="" && spaceProblem==false) {
    $("#load").show()
    //$("#load").text("hello")

    $.ajax({
        async: true,
        type: "POST",
        url: "http://localhost:3000/repos/create",
        dataType:"json",
        data:{
          "myID":id,
          "name":projectName
        //  "url": `https://github.com/${userName}/${name}.git`

        },
        success: function (json) {

          if (json.error!=null) {
            $("#alertSearch").text("Your Token is not valid")
            $("#alertSearch").show()
            $("#load").hide()

            return;
          }
          if (json.message!=null) {
            if (json.message!="created") {
              $("#alertSearch").text("Project already exist")
              $("#alertSearch").show()
              $("#load").hide()

              return ;
            }else {
              $("#load").hide()
              Swal.fire({
                title: "Project created successfully ! ",
                text: "Thank you",
                icon: 'success',
              }).then((result) => {
                if (result.value) {
                  window.location.reload()
                }
              })

              //

            }


          }


        },
        error: function (xhr, ajaxOptions, thrownError) {
          $("#load").hide()


        }
    });

  }



})
$.ajax({
    async: true,
    type: "POST",
    url: "http://localhost:3000/api/users/session",
    dataType:"json",
    success: function (json) {
     if (json.session=="") {
       document.location.href = `http://localhost:3000/login.html`

     }else {
       sessionStorage.setItem("userID",json.session)


     }
    },
    error: function (xhr, ajaxOptions, thrownError) {
    }
});
var notifications = new Array();
// for (var x = 0; x < notifications.length; x++) {
//   for (var y = 0; y < notifications.length; y++){
//     if (notifications[x]==notifications[y]) {
//       notifications.splice(x,1)
//     }
//   }
// }

$(function  () {

  var count = 0;
  var lastCount = count;
  var myID=sessionStorage.getItem("userID")
  // Pour la maquette
  $.ajax({
      async: true,
      type: "POST",
      url: "http://localhost:3000/api/users/id",
      dataType:"json",
      data:{
        "id":myID
      },
      success: function (json) {
        console.log(json);
      if (json.requests!=null) {

       for (var i = 0; i < json.requests.length; i++) {
         var projectName=json.requests[i].projectName
         var status=json.requests[i].status
         console.log(status);
         $.ajax({
             async: true,
             type: "POST",
             url: "http://localhost:3000/api/users/id",
             dataType:"json",
             data:{
               "id":json.requests[i].senderID
             },
             success: function (user) {
               var image=user.picture
               var alreadyexist=false;
               if (status=="waitForResponse") {
                 for (var i = 0; i < notifications.length; i++) {
                   if (notifications[i].texte==user.login +" wants to participate to "+ projectName) {
                     alreadyexist=true
                   }
                 }
                 if (alreadyexist==false) {
                   if (image==null) {

                     notifications.push({
                       href: "#",
                       image:`./assets/unknown.jpg`,
                       texte: user.login +" wants to participate to "+ projectName,
                     });
                     count++
                   }else {
                     notifications.push({
                       href: "#",
                       image:`data:image/png;base64,${user.picture}`,
                       texte: user.login +" wants to participate to "+ projectName,
                     });
                     count++

                   }
                 }


               }

             },
             error: function (xhr, ajaxOptions, thrownError) {
             }
         });


            }

      }

      },
      error: function (xhr, ajaxOptions, thrownError) {
      }
  });



  function makeBadge(texte) {
    return "<span class=\"badge badge-default\">" + texte + "</span>";
  }

  appNotifications = {

    // Initialisation
    init: function () {
      // On masque les éléments
      $("#notificationsBadge").hide();
      $("#notificationAucune").hide();

      // On bind le clic sur les notifications
      $("#notifications-dropdown").on('click', function () {

        var open = $("#notifications-dropdown").attr("aria-expanded");

        // Vérification si le menu est ouvert au moment du clic
        if (open === "false") {
          appNotifications.loadAll();
        }

      });

      // On charge les notifications
      appNotifications.loadAll();

      // Polling
      // Toutes les 3 minutes on vérifie si il n'y a pas de nouvelles notifications
      setInterval(function () {
        appNotifications.loadNumber();
      }, 18000);

      // Binding de marquage comme lue desktop
      $('.notification-read-desktop').on('click', function (event) {
        appNotifications.markAsReadDesktop(event, $(this));
      });

    },

    // Déclenche le chargement du nombre et des notifs
    loadAll: function () {

      // On ne charge les notifs que si il y a une différence
      // Ou si il n'y a aucune notifs
      if (count !== lastCount || count === 0) {
        appNotifications.load();
      }
      appNotifications.loadNumber();

    },

    // Masque de chargement pour l'icône et le badge
    badgeLoadingMask: function (show) {
      if (show === true) {
        $("#notificationsBadge").html(appNotifications.badgeSpinner);
        $("#notificationsBadge").show();
        // Mobile
        $("#notificationsBadgeMobile").html(count);
        $("#notificationsBadgeMobile").show();
      }
      else {
        $("#notificationsBadge").html(count);
        if (count > 0) {
          $("#notificationsIcon").removeClass("fa-bell-o");
          $("#notificationsIcon").addClass("fa-bell");
          $("#notificationsBadge").show();
          // Mobile
          $("#notificationsIconMobile").removeClass("fa-bell-o");
          $("#notificationsIconMobile").addClass("fa-bell");
          $("#notificationsBadgeMobile").show();
        }
        else {
          $("#notificationsIcon").addClass("fa-bell-o");
          $("#notificationsBadge").hide();
          // Mobile
          $("#notificationsIconMobile").addClass("fa-bell-o");
          $("#notificationsBadgeMobile").hide();
        }

      }
    },

    // Indique si chargement des notifications
    loadingMask: function (show) {

      if (show === true) {
        $("#notificationAucune").hide();
        $("#notificationsLoader").show();
      } else {
        $("#notificationsLoader").hide();
        if (count > 0) {
          $("#notificationAucune").hide();
        }
        else {
          $("#notificationAucune").show();
        }
      }

    },

    // Chargement du nombre de notifications
    loadNumber: function () {
      appNotifications.badgeLoadingMask(true);

      // TODO : API Call pour récupérer le nombre

      // TEMP : pour le template
      setTimeout(function () {
        $("#notificationsBadge").html(count);
        appNotifications.badgeLoadingMask(false);
      }, 1000);
    },

    // Chargement de notifications
    load: function () {
      appNotifications.loadingMask(true);

      // On vide les notifs
      $('#notificationsContainer').html("");

      // Sauvegarde du nombre de notifs
      lastCount = count;

      // TEMP : pour le template
      setTimeout(function () {

        // TEMP : pour le template
        for (i = 0; i < count; i++) {

          var template = $('#notificationTemplate').html();
          template = template.replace("{{href}}", notifications[i].href);
          template = template.replace("{{image}}", notifications[i].image);
          template = template.replace("{{texte}}", notifications[i].texte);
          template = template.replace("{{date}}", notifications[i].date);
          template = template.replace("{{allid}}",`allid${i}`);
          template = template.replace("{{Acceptid}}",`Accept${i}`);
          template = template.replace("{{Refuseid}}",`Refuse${i}`);

          $('#notificationsContainer').append(template);
        }

        // On bind le marquage comme lue
        $('.notification-read').on('click', function (event) {
          appNotifications.markAsRead(event, $(this));
        });

        // On arrête le chargement
        appNotifications.loadingMask(false);

        // On réactive le bouton
        $("#notifications-dropdown").prop("disabled", false);
      }, 1000);
    },

    // Marquer une notification comme lue
    markAsRead: function (event, elem) {
      // Permet de garde la liste ouverte
      event.preventDefault();
      event.stopPropagation();

      // Suppression de la notification
      elem.parent('.dropdown-notification').remove();

      // TEMP : pour le template
      count--;

      // Mise à jour du nombre
      appNotifications.loadAll();
    },

    // Marquer une notification comme lue version bureau
    markAsReadDesktop: function (event, elem) {
      // Permet de ne pas change de page
      event.preventDefault();
      event.stopPropagation();

      // Suppression de la notification
      elem.parent('.dropdown-notification').removeClass("notification-unread");
      elem.remove();

      // On supprime le focus
      if (document.activeElement) {
        document.activeElement.blur();
      }

      // TEMP : pour le template
      count--;

      // Mise à jour du nombre
      appNotifications.loadAll();
    },

    add: function () {
      lastCount = count;
      count++;
    },

    // Template du badge
    badgeSpinner: '<i class="fa fa-spinner fa-pulse fa-fw" aria-hidden="true"></i>'
  };

  appNotifications.init();

});

localStorage.setItem('selected_path',"");
$("#alertSearch").hide()
$(document).ready(function(){
$('#action_menu_btn').click(function(){
	$('.action_menu').toggle();
});
	});
   //create an instance of editor using Codemirror and set some options
   var editor=CodeMirror.fromTextArea(document.getElementById('editor-textarea'),
   {
     mode:"application/x-httpd-php",
     dragDrop:true,
     indentWithTabs: true,
     autocorrect:true,
     lineNumbers:true,
     autoCloseBrackets: true,
     theme: "dracula",
     extraKeys: {
       "Ctrl-Space":"autocomplete",
       "Ctrl-S": save,
       "Cmd-S":save

   },
     gutters: ["CodeMirror-linenumbers", "breakpoints"]
   });
   var m=0;
 var infos=[];
 var memory =[];
 var highlightedLine=[]
 var sender = false;
 var numberOfMsgs=0
 var tableOfProfiles=[];
 var timeid=0;
editor.on("gutterClick", function (cm, n) {
 var BreakpointsOnlyifEmpty="";
 var info = cm.lineInfo(n);
 var infoLine=info.line;
 var textContent=editor.getRange({line:n, ch:0},{line:n+1, ch:0});
 BreakpointsOnlyifEmpty=textContent;
 console.log(info);
 if (info.gutterMarkers!=null) {
   var line=info.line ;
   let i=0;
   while (infos[i]!=line && i<infos.length){
     i=i+1;
   }
   infos.splice(i,1);
   cm.setGutterMarker(n, "breakpoints", info.gutterMarkers ? null : null);

   console.log(infos);
 }else{
   if (BreakpointsOnlyifEmpty.length>1 && BreakpointsOnlyifEmpty!="") {
     infos.push(infoLine);
     infos.sort((a, b) => a - b);
     console.log(infos);
    /* var textContent=editor.getRange({line:0, ch:0},{line:infos[0]+1, ch:0});
     console.log(textContent)*/
     cm.setGutterMarker(n, "breakpoints", info.gutterMarkers ? null : makeMarker());

   }


 }
 //info.textbeforeLine=textContent;
 info.tableau=infos;
 console.log(info)

});

function removeAll(){
 for(var k of VisibleMap.keys()){
 for (var i = 0; i < VisibleMap.get(k).length; i++) {
    editor.setGutterMarker(VisibleMap.get(k)[i], "breakpoints",  null);
  }
 }
 for(var k of InvisibleMap.keys()){
  for (var i = 0; i < InvisibleMap.get(k).length; i++) {
    editor.setGutterMarker(InvisibleMap.get(k)[i], "breakpoints",  null);
  }
 }
 for (var i=0;i<infos.length;i++){
  editor.setGutterMarker(infos[i], "breakpoints", null);
     }
 for (var i=0;i<memory.length;i++){
  editor.setGutterMarker(memory[i], "breakpoints", null);
 }
 VisibleMap.clear();
 InvisibleMap.clear();
 infos=[];
 memory=[];
 setVisibility();

}

function hideAll(){
  let new_path=localStorage.getItem('selected_path');
  console.log(new_path);
  if (infos.length!=0) {
    if (VisibleMap.get(new_path)==null) {
      VisibleMap.set(new_path,infos);
    }else {
      for (var i = 0; i < infos.length; i++) {
        VisibleMap.get(new_path).push(infos[i]);
        VisibleMap.get(new_path).sort((a, b) => a - b);
      }
    }

  }
    if (VisibleMap.size!=0) {
      for (var k of VisibleMap.keys()) {
        if (k==new_path) {
          for (var i = 0; i < VisibleMap.get(k).length; i++) {
            editor.setGutterMarker(VisibleMap.get(k)[i], "breakpoints",  hideMarker());
          }
          if (InvisibleMap.get(k)==null) {
            InvisibleMap.set(k,VisibleMap.get(k));
          }else {
            for ( var i=0;i<VisibleMap.get(k).length;i++){
              InvisibleMap.get(k).push(VisibleMap.get(k)[i]);
              InvisibleMap.get(k).sort((a, b) => a - b);
            }
          }

          VisibleMap.delete(k);

        }
        console.log(infos);
      }

    }else{
      for (var i=0;i<infos.length;i++){
       editor.setGutterMarker(infos[i], "breakpoints",  hideMarker());
       memory.push(infos[i]);
           }
       InvisibleMap.set(new_path,infos);
    }

console.log(infos);


 infos=[];
  for(var i=0 ;i<highlightedLine.length;i++){
    editor.removeLineClass(highlightedLine[i], 'wrap', 'CodeMirror-activeline-background');

   }
 highlightedLine=[];
}


function checkInclusion (superset, subset) {
 if (0 === subset.length) {
   return false;
 }
 return subset.every(function (value) {
   return (superset.indexOf(value) >= 0);
 });
}

function show(BreakpointsInvisible,BreakpointsVisible){
   if (BreakpointsInvisible!=null || BreakpointsVisible!=null) {
     for (var i = 0; i < BreakpointsVisible.length; i++) {
       editor.setGutterMarker(BreakpointsVisible[i], "breakpoints",  makeMarker());
     }
     for (var i = 0; i < BreakpointsInvisible.length; i++) {
      editor.setGutterMarker(BreakpointsInvisible[i], "breakpoints",  hideMarker());
     }
   }

 }

function showAll(){
 let new_path=localStorage.getItem('selected_path');
 if (InvisibleMap.size!=0) {
   for(var k1 of InvisibleMap.keys()){
     if (k1==new_path) {
       for (var i = 0; i < InvisibleMap.get(k1).length; i++) {
         editor.setGutterMarker(InvisibleMap.get(k1)[i], "breakpoints",  makeMarker());
       }
     }
     VisibleMap.set(k1,InvisibleMap.get(k1));
     InvisibleMap.delete(k1)
   }
 }else {
   if (!checkInclusion(infos,memory)) {
    for (var i=0;i<memory.length;i++){
     editor.setGutterMarker(memory[i], "breakpoints",  makeMarker());
     infos.push(memory[i]);
     infos.sort((a, b) => a - b);
    }
   }

 }
 for (var i=0;i<infos.length;i++){
        editor.setGutterMarker(infos[i], "breakpoints",  makeMarker());
 }
 for(var i=0 ;i<highlightedLine.length;i++){
    editor.removeLineClass(highlightedLine[i], 'wrap', 'CodeMirror-activeline-background');
 }
 highlightedLine=[];
 memory=[];
}

editor.on("gutterClick", function(cm, n) {
 var info = cm.lineInfo(n);
 //info.textbeforeLine=textContent;
 console.log("done");

 console.log(editor);
 setVisibility();

});

function setVisibility(){
 var button1 = document.getElementById("X");
 var button2 = document.getElementById("Y");
 var button3 = document.getElementById("Z");
 var button4 = document.getElementById("T");
 var button5 = document.getElementById("U");

 if (infos.length!=0) {
   button1.style.visibility="visible";
   button2.style.visibility="visible";
   button3.style.visibility="visible";
   button4.style.visibility="visible";
   button5.style.visibility="visible";

 }else{
   button1.style.visibility="hidden";
   button2.style.visibility="hidden";
   button3.style.visibility="hidden";
   button4.style.visibility="hidden";
   button5.style.visibility="hidden";
    for(var i=0 ;i<highlightedLine.length;i++){
    editor.removeLineClass(highlightedLine[i], 'wrap', 'CodeMirror-activeline-background');

   }
   highlightedLine=[];



 }
 }
 function gotoProfile(){
   var login=document.getElementById("search").value;
   console.log(login);
   if (login!="") {
     $.ajax({
         async: true,
         type: "POST",
         url: "http://localhost:3000/api/users/login",
         dataType:"json",
         data: {
             "login":login
         },
         success: function (json) {
           console.log(json);
           if (json.id!=undefined) {

             $("#alertSearch").hide()
             var id=json.id;
             var myID=sessionStorage.getItem("userID")
             if (BigInt(id)==BigInt(myID)) {
               document.location.href = `http://localhost:3000/editProfile.html`

             }else {
               document.location.href = `http://localhost:3000/profile.html?ProfileID=${id}`

             }

           }else {
             $("#alertSearch").show()
           }

           //mettre l'id dans l'url
         },
         error: function (xhr, ajaxOptions, thrownError) {
         }
     });

   }


 }

 function showResult(str) {
   console.log(str);


   if (str!="") {
     $.ajax({
         async: true,
         type: "POST",
         url: "http://localhost:3000/api/users/name",
         dataType:"json",
         data:{
           "name":str
         },
         success: function (json) {
              if (typeof json.message !== 'undefined') {
                  $("datalist").prepend(`<option>${json.message}</option>`)
              }else {
                console.log(json[0]);
                console.log(json.length);
                for (var i = 0; i < json.length; i++) {
                  if (!tableOfProfiles.includes(json[i].login)) {
                    $("datalist").prepend(`<option>${json[i].login}</option>`)
                    tableOfProfiles.push(json[i].login)
                  }
                }

              }


            //  console.log(json.description);
             // if (json.message!=NULL) {
             //   if (json.message==" this project does nt exist ") {
             //   }
             // }
             //


          // document.getElementById("livesearch").innerHTML+=`<option>${json.message}</option>`

           console.log(json);


   }
  });
}

}
function step_by_step() {
   let new_path=localStorage.getItem('selected_path');
   if (infos.length==0) {
     length=highlightedLine.length;
     if(length!=0){
       editor.removeLineClass(highlightedLine[length-1], 'wrap', 'CodeMirror-activeline-background');
       console.log(highlightedLine)
       editor.addLineClass(highlightedLine[length-1]+1, 'wrap', 'CodeMirror-activeline-background');
       highlightedLine.push(highlightedLine[length-1]+1);
       console.log(highlightedLine);
     }else{
       editor.addLineClass(VisibleMap.get(new_path)[0], 'wrap', 'CodeMirror-activeline-background');
       highlightedLine.push(VisibleMap.get(new_path)[0]);
       console.log(highlightedLine);
     }
     //infos=VisibleMap.get(new_path);
   }else {
     console.log(infos);
     console.log(highlightedLine);
     length=highlightedLine.length;
     if(length!=0){
       editor.removeLineClass(highlightedLine[length-1], 'wrap', 'CodeMirror-activeline-background');
       console.log(highlightedLine)
       editor.addLineClass(highlightedLine[length-1]+1, 'wrap', 'CodeMirror-activeline-background');
       highlightedLine.push(highlightedLine[length-1]+1);
       console.log(highlightedLine);
     }else{
       editor.addLineClass(infos[0], 'wrap', 'CodeMirror-activeline-background');
       highlightedLine.push(infos[0]);
       console.log(highlightedLine);
     }
   }

}

function Resume() {
  let new_path=localStorage.getItem('selected_path');

  if (infos.length==0) {
    var j=0;
    console.log(highlightedLine);
  if (highlightedLine.length>0) {
    console.log(highlightedLine);
   while (j<=highlightedLine.length-1){
    var i=0;
    while (i<VisibleMap.get(new_path).length && VisibleMap.get(new_path)[i]!=highlightedLine[highlightedLine.length-j-1]){
      i++;
    }
    if (i>=VisibleMap.get(new_path).length) {
      j++;
      console.log(j);
    }else{
      break;
      console.log(infos[i]);
    }
   }
   editor.removeLineClass(highlightedLine[i], 'wrap', 'CodeMirror-activeline-background');
   editor.removeLineClass(highlightedLine[highlightedLine.length-1], 'wrap', 'CodeMirror-activeline-background');
   if (VisibleMap.get(new_path)[i+1]!=null) {
         editor.addLineClass(VisibleMap.get(new_path)[i+1], 'wrap', 'CodeMirror-activeline-background');
         highlightedLine.push(VisibleMap.get(new_path)[i+1]);
         //highlightedLine.splice(0,1);
         console.log(highlightedLine);
      }
  }else{

    editor.addLineClass(VisibleMap.get(new_path)[0], 'wrap', 'CodeMirror-activeline-background');
    highlightedLine.push(VisibleMap.get(new_path)[0]);

  }
  //  infos=VisibleMap.get(new_path);
 }else {
  var j=0;
  console.log(highlightedLine);
  if (highlightedLine.length>0) {
  console.log(highlightedLine);
  while (j<=highlightedLine.length-1){
   var i=0;
   while (i<infos.length && infos[i]!=highlightedLine[highlightedLine.length-j-1]){
    i++;
   }
   if (i>=infos.length) {
    j++;
    console.log(j);
   }else{
    break;
    console.log(infos[i]);
   }
  }
  editor.removeLineClass(highlightedLine[i], 'wrap', 'CodeMirror-activeline-background');
  editor.removeLineClass(highlightedLine[highlightedLine.length-1], 'wrap', 'CodeMirror-activeline-background');
  if (infos[i+1]!=null) {
       editor.addLineClass(infos[i+1], 'wrap', 'CodeMirror-activeline-background');
       highlightedLine.push(infos[i+1]);
       //highlightedLine.splice(0,1);
       console.log(highlightedLine);
    }
  }else{

  editor.addLineClass(infos[0], 'wrap', 'CodeMirror-activeline-background');
  highlightedLine.push(infos[0]);

}}}


function makeMarker() {
 var marker = document.createElement("div");
 marker.style.color = "#822";
 marker.innerHTML = "●";
 marker.style.marginLeft="-26px";
 return marker;


}

function hideMarker() {
 var marker = document.createElement("div");
 marker.style.color = "#6666FF";
 marker.innerHTML = "●";
 marker.style.marginLeft="-26px";
 return marker;


}


    editor.setSize(400,658);   //set editor size
    CodeMirror.commands.autocomplete = function(cm) {   //use the autocomplete for the editor
     cm.showHint({hint: CodeMirror.hint.anyword});
    }

   function myFunction(){
    var x = document.getElementById("lang").value;
    if  (x=="1") {
     editor.setOption("mode","application/x-httpd-php");
    }if (x=="2") {
     editor.setOption("mode","javascript");
    }if (x=="3") {
     editor.setOption("mode","python");
    }if (x=="4") {
     editor.setOption("mode","php");
    }
   }

   function virtual_Save(){
     var textContent=editor.getValue();
     //console.log("voici le nouveau: "+textContent);
     var selected_path = localStorage.getItem('selected_path');
     //console.log(textContent);
     console.log(selected_path);
    if (textContent.length!=0 && textContent!="" && selected_path!="") {

     $.ajax({
         async: true,
         type: "POST",
         url: "http://localhost:3000/save/fictiveSave",
         dataType:"json",
         data: {
             "code":textContent,
             "path":selected_path
         },
         success: function (json) {
           console.log("virtualy saved");
         },
         error: function (xhr, ajaxOptions, thrownError) {
           console.log("Error");
         }
     });
   }
   };
     //setInterval(virtual_Save,200)

   function save() {

      var textContent=editor.getValue();
      var selected_path = localStorage.getItem('selected_path');
      console.log(textContent);
      console.log(selected_path);

      $.ajax({
          async: true,
          type: "POST",
          url: "http://localhost:3000/save",
          dataType:"json",
          data: {
              "code":textContent,
              "path":selected_path
          },
          success: function (json) {
            console.log("done");
          },
          error: function (xhr, ajaxOptions, thrownError) {
            console.log("Error");
          }
      });
      //document.getElementById('saved')="saved"
      var x=document.getElementById('saved');
      x.textContent="save"
    };
 //function to set lineNumbers  editor's options
   $(function lineNumbers_Activation() {
    $('#toggle-event').change(function() {
     if ( $(this).prop('checked')) {
      editor.setOption("lineNumbers",true);
     }else{
      editor.setOption("lineNumbers",false);

     }
   })})
  //set the chosen theme in editor's options

 function theme0(){
   editor.setOption("theme","");
  }
 function theme1(){
   editor.setOption("theme","dracula");
 }
 function theme2(){
   editor.setOption("theme","blackboard");
 }
 function theme3(){
   editor.setOption("theme","xq-dark");
 }

 editor.on("update",function changed(){
   virtual_Save();
   var x=document.getElementById('saved');
   var new_path =localStorage.getItem('selected_path');
   if (new_path!="") {
     setTimeout(function(){$.ajax({
         async: true,
         type: "POST",
         url: "http://localhost:3000/save/show",
         dataType:"json",
         data:{
           "new_path":new_path
         },
         success: function (json) {
           console.log("verfication");
           console.log(json.variation);
           if (json.variation==true) {
             x.textContent="save*"
           }else {
             x.textContent="save"

           }

         },

         error: function (xhr, ajaxOptions, thrownError) {

         }
       })
     },200);
   }

   });




   $('#run').click(function sendCode () {

             var textContent=editor.getValue();
              $.ajax({
                  async: true,
                  type: "POST",
                  url: "http://localhost:3000/php",
                  dataType:"json",
                  data: {
                      "id":sessionStorage.getItem("userID"),
                  },
                  success: function (json) {
                    if (json.message=="select a project") {
                      Swal.fire(
                        'Project not found !',
                        'Select a project or create a new one',
                        'error'

                      )

                    }else {
                      document.getElementById('run').href=`http://${json.message}.ci/`;
                      console.log(document.getElementById('run').href);

                    }
                  },
                  error: function (xhr, ajaxOptions, thrownError) {
                    //  alert(xhr.status);
                    //  alert(thrownError);
                  }
              });

   });

  $(function () {
     let myID=sessionStorage.getItem("userID")
              $.ajax({
                  async: true,
                  type: "POST",
                  url: "http://localhost:3000/home/editor",
                  dataType: "json",
                  data:{
                    "id":myID
                  },
                  success: function (json) {
                      create_tree(json);
                  },

                  error: function (xhr, ajaxOptions, thrownError) {
                      alert(xhr.status);
                      alert(thrownError);
                  }
              });
          });
   function create_tree(jsondata){
    //  create an instance with one node
    $('#jstree').jstree({
         "core" : {
           "animation" : 0,
           "check_callback" : true,
           'data' : {
             'data' : function (node) {
                 return { 'id' : node.id };
                }
           },
           "themes" : { "stripes" : true },
           'data' : jsondata
           },
           "types" : {
             "#" : {
                   "max_children" : 3,
                   "max_depth" : 6,              //set max number of children's node
                   "valid_children" : ["root"]
                 },
            "root" : {
              "icon" : "/static/3.3.8/assets/images/tree_icon.png",
                "valid_children" : ["default"]
            },

            "default" : {
                   "valid_children" : ["default","file"]
            },
            "file" : {
                   "icon" : "glyphicon glyphicon-file",
                   "valid_children" : []
                 }
           },
           'contextmenu' : {
            'items' : function(node) {
               var tmp = $.jstree.defaults.contextmenu.items();
               delete tmp.create.action;
               tmp.create.label = "New";
               tmp.create.submenu = {
                 "create_folder" : {
                   "separator_after"	: true,
                   "label"				: "Folder",
                   "action"			: function (data) {
                   var inst = $.jstree.reference(data.reference),
                   obj = inst.get_node(data.reference);
                   inst.create_node(obj, { type : "default" }, "last", function (new_node) {
                       var path=inst.get_path(new_node,'/');
                       var name=inst.get_text();
                       console.log(new_node);
                       new_node.original.path = path;
                       console.log(new_node);

                       $.ajax({
                           async: true,
                           type: "POST",
                           url: "http://localhost:3000/home/project",
                           data: {
                             "path":path,
                             "type":"folder"
                           },
                           success: function (json) {
                           },

                           error: function (xhr, ajaxOptions, thrownError) {
                               alert(thrownError);
                           }
                       });

                       //put("/file/create", {path: "path", type:"file"})
                        setTimeout(function () { inst.edit(new_node); },0);
                     });
                   }
                 },
                 "create_file" : {
                   "label"				: "File",
                   "action"			: function (data) {
                      var inst = $.jstree.reference(data.reference),
                      obj = inst.get_node(data.reference);
                      inst.create_node(obj, { type : "file" }, "last", function (new_node) {
                      var name=inst.get_text();
                      var path=inst.get_path(new_node,'/');
                      new_node.original.path = path;
                      $.ajax({
                          async: true,
                          type: "POST",
                          url: "http://localhost:3000/home/project",
                          data: {
                            "path":path,
                            "type":"file"
                          },
                          success: function (json) {
                            //alert("done");
                          },

                          error: function (xhr, ajaxOptions, thrownError) {
                              alert(thrownError);
                          }

                      });

                      //put("/file/create", {path: "path", type:"file"})
                       setTimeout(function () { inst.edit(new_node); },0);

                     });
                   }
                 }
               };
               if(this.get_type(node) === "file") {
                 delete tmp.create;
               }
               return tmp;
             }
           },
          "plugins" : [
               "contextmenu",  // set the context menu (create/rename/delete nodeds)
               "dnd",          // allow drag and drop
               "search",
               "state",
               "types"
               ]
      });
    }

   var VisibleMap=new Map();
   var InvisibleMap=new Map();

   $('#jstree').on("changed.jstree", function(e, data) {
     var VisibleBreakpointsToLoad=[];
     var InvisibleBreakpointsToLoad=[];
     var type_of_selected=data.node.type == "default" ? "folder" : "file";
     if (type_of_selected=="file") {
       var old_path =localStorage.getItem('selected_path');
       console.log("old_path: "+old_path);
     }
     var new_path = data.node.original.path;
     new_path = new_path.replace(/\/[^\/]*$/, `/${data.node.text}`);
     console.log("new_path: "+new_path);
     if (type_of_selected=="file") {
       localStorage.setItem('selected_path', new_path);
     }
     if (infos.length!=0) {
       if (VisibleMap.get(old_path)==null) {
         VisibleMap.set(old_path,infos);
       }else {
         for (var i=0;i<infos.length;i++){
           VisibleMap.get(old_path).push(infos[i]);
           VisibleMap.get(old_path).sort((a, b) => a - b);
         }
       }
     }
     if (memory.length!=0) {
       InvisibleMap.set(old_path,memory);
     }
     if (type_of_selected=="file") {
     $.ajax({
         async: true,
         type: "POST",
         url: "http://localhost:3000/save/show",
         dataType:"json",
         data:{
           "new_path":new_path
         },
         success: function (json) {
           //console.log("done");
           editor.setValue(json.code);
           for (var path of VisibleMap.keys()) {
             console.log(VisibleMap);
              if (path==new_path && VisibleMap.get(path).length!=0) {
                  VisibleBreakpointsToLoad=VisibleMap.get(path);
                  console.log(VisibleBreakpointsToLoad);
                  console.log(infos);
              }
           }
           for (var path of InvisibleMap.keys()) {
             console.log(InvisibleMap);
              if (path==new_path && InvisibleMap.get(path).length!=0) {
                  InvisibleBreakpointsToLoad=InvisibleMap.get(path);
                  console.log(InvisibleBreakpointsToLoad);
                  console.log(infos);
              }
           }
           show(InvisibleBreakpointsToLoad,VisibleBreakpointsToLoad)
           infos=[];
           memory=[];
           highlightedLine=[];
         },
         error: function (xhr, ajaxOptions, thrownError) {
           //  alert(xhr.status);
           //  alert(thrownError);
         }
     });}});

   $('#jstree').on('delete_node.jstree', function (e, data) {
         let node = data.node;
         let path = node.original.path;
         let type = node.type == "default" ? "folder" : "file";
         console.log(path);
         //let new_path = old_path.replace(/\/[^\/]*$/, `/${node.text}`)
         if (type=="file") {
           path=localStorage.getItem('selected_path');
         }
       $.ajax({
           async: true,
           type: "DELETE",
           url: "http://localhost:3000/home/project",
           data: {
             "path":path,
             "type":type

           },
           success: function (json) {
             //alert("done");
           },

           error: function (xhr, ajaxOptions, thrownError) {
               alert(thrownError);
           }
       });
      });

   $('#jstree').on('rename_node.jstree', function (e, data) {
        // var inst = $.jstree.reference(data.reference);
        let node = data.node;
        let old_path = node.original.path;
        let new_path = old_path.replace(/\/[^\/]*$/, `/${node.text}`);
        node.original.new_path=new_path;
        console.log(node);
        console.log(new_path);
        $.ajax({
            async: true,
            type: "PUT",
            url: "http://localhost:3000/home/project",
            data: {
              "old_path": old_path,
              "new_path": new_path,
            },
            success: function (json) {
            //  alert("done");
            },

            error: function (xhr, ajaxOptions, thrownError) {
                alert(thrownError);
            }
        });
       });

   $('#jstree').on('move_node.jstree', function (e, data) {
        let node = data.node;
        let newParent=data.parent;
        let oldParent=data.old_parent;

        let new_path="";
        let tab=$('#jstree').jstree(true).get_path(newParent);
        for (var i = 0; i < tab.length; i++) {
          new_path+=tab[i]+"/"
        }
        data.node.original.path=new_path
        //let tab=$('#jstree').jstree(true).get_path(newParent);
        console.log(data);
        console.log(new_path);

        // console.log($('#jstree').get_path(newParent));
        // let old_path = node.original.path;
        // let new_path = old_path.replace(/\/[^\/]*$/, `/${node.text}`)
        // console.log(new_path);
        // $.ajax({
        //     async: true,
        //     type: "PUT",
        //     url: "http://localhost:3000/home/project",
        //     data: {
        //       "old_path": old_path,
        //       "new_path": new_path,
        //     },
        //     success: function (json) {
        //     //  alert("done");
        //     },
        //
        //     error: function (xhr, ajaxOptions, thrownError) {
        //         alert(thrownError);
        //     }
        // });
    	});

      function CleanConversation(){
        $("div1").empty()
        $("div2").empty()
        numberOfMsgs=0
        document.getElementById('numberOfMsgs').innerHTML=numberOfMsgs.toString()+" messages"


      }

/*
      function RefreshMastodon(){

        $.ajax({
            async: true,
            type: "POST",
            url: "http://localhost:3000/mastodon",
            data: {

            },
            success: function (json) {
              console.log(json);
              var updateConversation="";
              for (x in json) {
                  updateConversation+=json[x]+"<br>";
                  document.getElementById('chatBox').srcdoc=updateConversation;
                }
              },
              // response=json.msg3+"\n"+json.msg2+"\n"+json.msg1+"\n"+json.msg0;
              // document.getElementById('chatBox').srcdoc+=response;
            error: function (xhr, ajaxOptions, thrownError) {
                alert(thrownError);
            }

        });
      }
      function RefreshSlack(){

        $.ajax({
            async: true,
            type: "POST",
            url: "http://localhost:3000/slack",
            data: {

            },
            success: function (json) {
              console.log(json);
              var updateConversation="";
              for (x in json) {
                  updateConversation+=json[x]+"<br>";
                  document.getElementById('chatBox').srcdoc=updateConversation;
                }
              },
              // response=json.msg3+"\n"+json.msg2+"\n"+json.msg1+"\n"+json.msg0;
              // document.getElementById('chatBox').srcdoc+=response;
            error: function (xhr, ajaxOptions, thrownError) {
                alert(thrownError);
            }

        });
      }
*/
//Sound for chatBox
var snd2 = new Audio("./assets/audio2.wav");

  var NbMessageRecieved=0
  function playMusic(snd){
     var info = document.getElementById("message");

  if (!document.hasFocus()) {
        console.log("NO FOCUS");
        snd.play();
        window.parent.document.title = "("+NbMessageRecieved+") new message !"
        NbMessageRecieved++;
  }
  }
  setInterval( checkPageFocus, 200 );

function checkPageFocus() {
  var info = document.getElementById("message");

  if ( !document.hasFocus() ) {
  } else {
     NbMessageRecieved=1;
    console.log(NbMessageRecieved)
    window.parent.document.title = "Editeur"

  }
}

      var socket = io.connect('http://localhost:8000');
      socket.on('message', function(message) {
              console.log(message);
              message.value=message.value.replace("<p>"," ");
              message.value=message.value.replace("</p>","");

              console.log('Le serveur a un message pour vous : ' + message);

              playMusic(snd2);
            console.log("sender"+sender);
            if (message.sender!=undefined) {
              if (message.sender==false) {
                sender=true;
              }else {
                sender=false;
              }
            }


              if (sender==false) {
                addElementrecieved(message.value,message.avatar)

              }else {
                addElement(message.value);
              }
              sender=false
              //document.getElementById('chatBox').srcdoc+=message;

          })

  function addElementrecieved(value,avatar){
    console.log(value);
    let date=new Date()
    var time=timeid.toString()
    $('#msgs').append(`<div1 class="d-flex justify-content-end mb-4">
      <div id="msg2" class="msg_cotainer_send">
      ${value}
        <span id=${time} class="msg_time_send"></span>
      </div>
      <div id="avatar" class="img_cont_msg">
    <img  src=${avatar} class="rounded-circle user_img_msg"/>
      </div>
    </div1>`);
    document.getElementById(time).innerHTML=date.toLocaleDateString()+" "+date.getHours()+":"+date.getMinutes();
    timeid++
    // document.getElementById('msgs').innerHTML += `<div1 class="d-flex justify-content-end mb-4">
    //   <div id="msg2" class="msg_cotainer_send">
    //   ${value}
    //     <span id="Time" class="msg_time_send"></span>
    //   </div>
    //   <div id="avatar" class="img_cont_msg">
    // <img src={{avatar}} class="rounded-circle user_img_msg"/>
    //   </div>
    // </div1>`
    //document.getElementById('avatarRecieve').src=avatar

    numberOfMsgs+=1
    document.getElementById('numberOfMsgs').innerHTML=numberOfMsgs.toString()+" messages"


  }
  function editProfile(){
    var sessionkey=sessionStorage.getItem("userID")
    document.location.href = `http://localhost:3000/editProfile.html?id=${sessionkey}`

  }
  function logout(){
    $.ajax({
        async: true,
        type: "POST",
        url: "http://localhost:3000/api/users/verifyCommit",
        dataType:"json",
        data:{
          "id":sessionStorage.getItem("userID")
        },
        success: function (json) {

          if (json.message!=null) {
            console.log(json.message);
            if (json.message=="no projects") {

              setTimeout(function(){
                var sessionkey=sessionStorage.removeItem("userID")
                document.location.href = `http://localhost:3000/login.html`

              },100)



            }else if(json.message!="no problem"){
              console.log(json);
              if (json.message.length!=0) {


              Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                html: `
                       Projects not commited:
                       <li>${json.message}</li>
                     ` ,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete changes!'
              }).then((result) => {
                if (result.value) {
                   $.ajax({
                       async: true,
                       type: "POST",
                       url: "http://localhost:3000/api/users/logout",
                       dataType:"json",
                       data:{
                         "id":sessionStorage.getItem("userID")
                       },
                       success: function (json) {
                         if (json.message=="deleted") {
                           Swal.fire(
                             'Changes deleted!',
                             'Your changes have been deleted.',
                             'success'

                           ).then((result)=>{
                             if (result.value) {
                               setTimeout(function(){
                                 var sessionkey=sessionStorage.removeItem("userID")
                                 document.location.href = `http://localhost:3000/login.html`

                               },100)

                             }
                           })
                         }

                       },
                       error: function (xhr, ajaxOptions, thrownError) {
                       }
                   });


                 }
                })
              }else {
                Swal.fire({
                  title: 'Are you sure ?',
                  text: 'For your project, we created a start src directory, we recommand you to push it before leaving',
                  icon: 'warning',
                  showCancelButton: true,
                  confirmButtonColor: '#3085d6',
                  cancelButtonColor: '#d33',
                  confirmButtonText: 'Later'
                }).then((result) => {
                  if (result.value) {
                     $.ajax({
                         async: true,
                         type: "POST",
                         url: "http://localhost:3000/api/users/logout",
                         dataType:"json",
                         data:{
                           "id":sessionStorage.getItem("userID")
                         },
                         success: function (json) {

                                   var sessionkey=sessionStorage.removeItem("userID")
                                   document.location.href = `http://localhost:3000/login.html`







                         },
                         error: function (xhr, ajaxOptions, thrownError) {
                         }
                     });


                   }
                  })
              }
            }else {
            setTimeout(function(){  $.ajax({
                  async: true,
                  type: "POST",
                  url: "http://localhost:3000/api/users/logout",
                  dataType:"json",
                  data:{
                    "id":sessionStorage.getItem("userID")
                  },
                  success: function (json) {
                    console.log("heloooo");
                    setTimeout(function(){
                      var sessionkey=sessionStorage.removeItem("userID")
                      document.location.href = `http://localhost:3000/login.html`

                    },100)
                  },
                  error: function (xhr, ajaxOptions, thrownError) {
                  }
              });
            },200)

                        // var sessionkey=sessionStorage.removeItem("userID")
                        // document.location.href = `http://localhost:3000/login.html`
            }

          }else {
            console.log(json);

            var sessionkey=sessionStorage.removeItem("userID")
            document.location.href = `http://localhost:3000/login.html`

          }
        },
        error: function (xhr, ajaxOptions, thrownError) {
        }
    });


  }

  function addElement (value) {
    let date=new Date()
    var time1=timeid.toString();
    let idOfUser=sessionStorage.getItem("userID")
    let id=parseInt(idOfUser)
    $.ajax({
        async: true,
        type: "POST",
        url: "http://localhost:3000/api/users/id",
        data: {
          "id":id
        },
        success: function (json) {
          if (json.picture==null) {
            var image=`./assets/unknown.jpg`

          }else {
            var image=`data:image/png;base64,${json.picture}`
          }
          console.log(image);
          $("#msgs").append(`<div2 class="d-flex justify-content-start mb-4">
            <div id="msg1" class="img_cont_msg">
              <img src=${image} class="rounded-circle user_img_msg">
            </div>
            <div class="msg_cotainer">
              ${value}
              <span id=${time1} class="msg_time"></span>
            </div>
          </div2>`);
            //  document.getElementById('chatBox').srcdoc+="<br>"+value;
          },
          // response=json.msg3+"\n"+json.msg2+"\n"+json.msg1+"\n"+json.msg0;
          // document.getElementById('chatBox').srcdoc+=response;
        error: function (xhr, ajaxOptions, thrownError) {
            alert(thrownError);
        }

    });


    document.getElementById(time1).innerHTML=date.toLocaleDateString()+" "+date.getHours()+":"+date.getMinutes();
    timeid++
    numberOfMsgs+=1
    document.getElementById('numberOfMsgs').innerHTML=numberOfMsgs.toString()+" messages"

  // crée un nouvel élément div
  // var newDiv = document.createElement("div");
  // // et lui donne un peu de contenu
  // newDiv.class="d-flex justify-content-end mb-4";
  // newDiv.id="new msg"
  // console.log(newDiv);
  // var newContent = document.createTextNode(message);
  // // ajoute le nœud texte au nouveau div créé
  // newDiv.appendChild(newContent);
  // var sp2 = document.getElementById("msg2");
  // var parentDiv = document.getElementById("msg2").parentNode;
  // ajoute le nouvel élément créé et son contenu dans le DOM
//  let currentDiv = document.getElementById('titre')
  //var currentDiv = document.getElementById('msg2');
  //console.log(currentDiv);
//  parentDiv.insertBefore(newDiv, sp2);
}

var id=sessionStorage.getItem("userID")
console.log(id);
$.ajax({
    async: true,
    type: "POST",
    url: "http://localhost:3000/api/users/id",
    data: {
      "id":id
    },
    success: function (json) {
      console.log(json.picture);
      if (json.picture==null) {
        $("#LogoutImage").attr('src',"./assets/unknown.jpg");
        $("#chatphoto").attr('src',"./assets/unknown.jpg");


      }else {
        let profilephoto=`data:image/png;base64,${json.picture}`
        $("#LogoutImage").attr('src',profilephoto);
        $("#chatphoto").attr('src',profilephoto);

      }

        //  document.getElementById('chatBox').srcdoc+="<br>"+value;
      },
      // response=json.msg3+"\n"+json.msg2+"\n"+json.msg1+"\n"+json.msg0;
      // document.getElementById('chatBox').srcdoc+=response;
    error: function (xhr, ajaxOptions, thrownError) {
        alert(thrownError);
    }

});


      function putMastodonMessage(){
        var value=document.getElementById('inputSlack').value;
        console.log(value);
        $.ajax({
            async: true,
            type: "POST",
            url: "http://localhost:3000/mastodon/send",
            data: {
              "message":value
            },
            success: function (json) {
                  value= `${json.name}: ${value}`;
                  console.log(value);
                  sender=json.sender;
                //  document.getElementById('chatBox').srcdoc+="<br>"+value;
              },
              // response=json.msg3+"\n"+json.msg2+"\n"+json.msg1+"\n"+json.msg0;
              // document.getElementById('chatBox').srcdoc+=response;
            error: function (xhr, ajaxOptions, thrownError) {
                alert(thrownError);
            }

        });
        $('#inputSlack').val('');

}

function pressEnter() {
               var code=event.which || event.keyCode; //Selon le navigateur c'est which ou keyCode
               if (code==13) { //le code de la touche Enter
                 console.log("pressed");
                 putMastodonMessage();
               }
           }
           function pressEnterInSearch() {
                          var code=event.which || event.keyCode; //Selon le navigateur c'est which ou keyCode
                          if (code==13) { //le code de la touche Enter
                            console.log("pressed");
                            gotoProfile();
                          }
                      }


      function putSlackMessage(){
        var value=document.getElementById('inputSlack').value;
        console.log(value);
        $.ajax({
            async: true,
            type: "POST",
            url: "http://localhost:3000/slack/send",
            data: {
              "message":value
            },
            success: function (json) {
                  value=json.name+": "+value;
                  document.getElementById('chatBox').srcdoc+="<br>"+value;
              },
              // response=json.msg3+"\n"+json.msg2+"\n"+json.msg1+"\n"+json.msg0;
              // document.getElementById('chatBox').srcdoc+=response;
            error: function (xhr, ajaxOptions, thrownError) {
                alert(thrownError);
            }

        });


      }
      //don't need anymore to that funcion because i use fs-extra package to run
      function zip(){
        $.ajax({
            async: true,
            type: "POST",
            url: "http://localhost:3000/zip/",
            data: {
            },
            success: function (json) {

              },
              // response=json.msg3+"\n"+json.msg2+"\n"+json.msg1+"\n"+json.msg0;
              // document.getElementById('chatBox').srcdoc+=response;
            error: function (xhr, ajaxOptions, thrownError) {
                alert(thrownError);
            }

        });
      }



    setTimeout(function(){
      if(window.location.href.substr(-2) !== "?r") {
      window.location = window.location.href + "?r";
    }
  },100)
  </script>
  </body>
  </html>
